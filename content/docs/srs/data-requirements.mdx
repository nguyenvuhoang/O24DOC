---
title: "Yêu Cầu Dữ Liệu"
description: "Data Requirements - Yêu cầu về dữ liệu và cấu trúc database của hệ thống W4S"
---

## 6. Yêu Cầu Dữ Liệu (Data Requirements)

### 6.1 Entity Relationship Diagram

```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│    USER     │       │   WALLET    │       │ TRANSACTION │
├─────────────┤       ├─────────────┤       ├─────────────┤
│ id (PK)     │──┐    │ id (PK)     │──┐    │ id (PK)     │
│ email       │  │    │ user_id (FK)│◄─┘    │ wallet_id   │◄┐
│ phone       │  │    │ name        │  ┌───►│ category_id │ │
│ password    │  │    │ type        │  │    │ amount      │ │
│ full_name   │  │    │ currency    │  │    │ type        │ │
│ avatar      │  │    │ balance     │  │    │ date        │ │
│ settings    │  │    │ icon        │  │    │ note        │ │
│ created_at  │  │    │ color       │  │    │ created_at  │ │
│ updated_at  │  │    │ is_archived │  │    │ updated_at  │ │
└─────────────┘  │    │ created_at  │  │    │ deleted_at  │ │
                 │    └─────────────┘  │    └─────────────┘ │
                 │                     │                    │
                 │    ┌─────────────┐  │    ┌─────────────┐ │
                 │    │  CATEGORY   │  │    │    DEBT     │ │
                 │    ├─────────────┤  │    ├─────────────┤ │
                 │    │ id (PK)     │──┘    │ id (PK)     │ │
                 │    │ user_id (FK)│◄──┐   │ user_id(FK) │◄┘
                 │    │ parent_id   │   │   │ wallet_id   │
                 │    │ name        │   │   │ contact     │
                 │    │ type        │   │   │ amount      │
                 │    │ icon        │   │   │ remaining   │
                 │    │ color       │   │   │ type        │
                 │    │ is_system   │   │   │ due_date    │
                 │    └─────────────┘   │   │ status      │
                 │                      │   └─────────────┘
                 │    ┌─────────────┐   │
                 │    │   BUDGET    │   │   ┌─────────────┐
                 │    ├─────────────┤   │   │ SAVING_GOAL │
                 │    │ id (PK)     │   │   ├─────────────┤
                 └───►│ user_id(FK) │   │   │ id (PK)     │
                      │ category_id │◄──┘   │ user_id(FK) │◄┐
                      │ amount      │       │ name        │ │
                      │ period      │       │ target      │ │
                      │ start_date  │       │ current     │ │
                      │ rollover    │       │ target_date │ │
                      └─────────────┘       │ status      │ │
                                            └─────────────┘ │
                      ┌─────────────┐                       │
                      │  RECURRING  │                       │
                      ├─────────────┤                       │
                      │ id (PK)     │                       │
                      │ user_id(FK) │◄──────────────────────┘
                      │ template    │
                      │ frequency   │
                      │ next_run    │
                      │ end_date    │
                      │ is_active   │
                      └─────────────┘
```

### 6.2 Xử Lý Đa Tiền Tệ

| Aspect | Implementation |
|--------|----------------|
| **Base Currency** | Mỗi user chọn 1 base currency |
| **Wallet Currency** | Mỗi wallet có 1 currency cố định |
| **Exchange Rate** | - Tự động lấy từ API (daily)<br/>- Cho phép nhập manual |
| **Conversion** | Chuyển đổi khi báo cáo tổng hợp |
| **Storage** | Lưu amount gốc + converted amount |

### 6.3 Khái Niệm Ledger (Sổ Cái)

```
┌────────────────────────────────────────────────────────────────┐
│                        LEDGER ENTRIES                          │
├────────────────────────────────────────────────────────────────┤
│ Mỗi transaction tạo ra các ledger entries theo nguyên tắc:     │
│                                                                │
│ EXPENSE (Chi tiêu):                                            │
│   Debit: Expense Category                                      │
│   Credit: Wallet (Cash/Bank)                                   │
│                                                                │
│ INCOME (Thu nhập):                                             │
│   Debit: Wallet (Cash/Bank)                                    │
│   Credit: Income Category                                      │
│                                                                │
│ TRANSFER (Chuyển khoản):                                       │
│   Debit: Wallet B (destination)                                │
│   Credit: Wallet A (source)                                    │
│                                                                │
│ → Đảm bảo cân bằng: Total Debit = Total Credit                │
└────────────────────────────────────────────────────────────────┘
```

---
